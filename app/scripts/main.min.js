"use strict";!function(t){function e(e){this.$panorama=null,this.$moveElement=null,this.swipeMode=null,this.timestart=0,this.seconds=60,this.msTotal=0,this.direction=-1,this.positionX=0,this.percentage=0,this.animationFrameID=!1,this.myRequestAnimationFrame=function(){return function(t){return window.setTimeout(t,1e3/60)}}(),this.touchPlayTimeout=5e3,this.moveTimeoutID=null,this.transitionTimeoutID=null,this.dragPositionTimeoutID=null,this.rightBoundary=null,this.touchSpeed=25,this.touchDistance={start:0,end:0},this.callback=[],this.step=function(e){var o,i,n=this;o=Date.now(),n.progress=o-e,n.percentage=n.progress*(100/n.msTotal),i=n.direction*n.percentage,i=n.positionBounderies(i),i+="%",n.position(i),n.progress<n.msTotal&&(o+=10,n.animationFrameID=n.myRequestAnimationFrame(function(){n.step.call(n,e)})),n.percentage>=this.rightBoundary&&(clearTimeout(n.animationFrameID),"object"==typeof n.callback&&t.each(n.callback,function(t,e){e()}))},this.positionBounderies=function(t){return this.rightBoundary=100-100*(this.$panorama.width()/this.$moveElement.width()),t=t>0?0:t,t=0>t&&Math.abs(t)>this.rightBoundary?this.direction*this.rightBoundary:t},this.progressByPercentage=function(t){return t*(this.msTotal/100)},this.dragIt=function(t){var e,o=this,i=this.progress*(100/this.msTotal);e=this.direction*i,e+=t/this.touchSpeed,e=this.positionBounderies(e),e+="%",this.percentage=Math.abs(parseFloat(e)),o.dragPositionTimeoutID=setTimeout(function(){o.position(e)},50)},this.position=function(t){this.$moveElement.css("transform","translateX("+t+")")},this.reset=function(){var t=this;t.$moveElement.on("transitionend",function(e){"opacity"===e.originalEvent.propertyName&&("0"===t.$moveElement.css("opacity")?(t.percentage=0,t.progress=0,t.position(0),t.$moveElement.removeClass("end")):t.step(Date.now()))}),t.$moveElement.addClass("end")},this.init=function(t){var e=this;this.$panorama=t,this.$moveElement=t.find("img"),this.swipeMode=t.data("swipe"),this.msTotal=1e3*this.seconds,this.$moveElement.on("tap touchstart mousedown",function(t){console.log("touchstart or tap",Date.now()),t.preventDefault();var o="mousedown"===t.type?t:t.originalEvent.touches[0];clearTimeout(e.animationFrameID),clearTimeout(e.moveTimeoutID),clearTimeout(e.transitionTimeoutID),Boolean(e.swipeMode)===!0?e.$moveElement.addClass("touch"):null,e.touchDistance.start=o.pageX,e.$moveElement.off("transitionend").on("transitionend",function(t){"transform"===t.originalEvent.propertyName&&e.$moveElement.removeClass("dragTransition")})}),this.$moveElement.on("touchend mouseup",function(t){t.preventDefault();var o=null;e.progress=e.progressByPercentage(e.percentage),e.$moveElement.addClass("dragTransition"),e.moveTimeoutID=setTimeout(function(){clearTimeout(e.moveTimeoutID),o=Date.now(),o-=e.progress,e.$moveElement.removeClass("dragTransition"),e.step(o),Boolean(e.swipeMode)===!0?e.$moveElement.removeClass("touch"):null},e.touchPlayTimeout)}),this.$moveElement.on("touchmove drag",function(t){var o="drag"===t.type||"mousemove"===t.type?t:t.originalEvent.touches[0],i=0;e.oldX=o.pageX,e.touchDistance.end=o.pageX,i=e.touchDistance.end-e.touchDistance.start,e.dragIt(i)}),this.callback.push(this.reset.bind(this)),this.step(Date.now())},this.init(e)}t.fn.panorama=function(){return function(t){new e(t)}(this)}}(jQuery),$("document").ready(function(){$("#foo").panorama(),$("#bar").panorama()});