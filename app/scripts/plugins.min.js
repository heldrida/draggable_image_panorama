!function(e){e.fn.drag=function(t,a,n){var r="string"==typeof t?t:"",i=e.isFunction(t)?t:e.isFunction(a)?a:null;return 0!==r.indexOf("drag")&&(r="drag"+r),n=(t==i?a:n)||{},i?this.bind(r,n,i):this.trigger(r)};var t=e.event,a="ontouchstart"in document.documentElement,n=a?"touchstart":"mousedown",r=a?"touchmove touchend":"mousemove mouseup",i=function(t,a){if(!a.touchXY||!t.originalEvent)return t;var n=t.originalEvent.changedTouches||t.originalEvent.touches;return n&&n.length&&e.extend(t,n[0]),t},o=t.special,d=o.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!1,click:!1,touchXY:!0},datakey:"dragdata",livekey:"livedrag",add:function(a){var n=e.data(this,d.datakey),r=a.data||{};n.related+=1,!n.live&&a.selector&&(n.live=!0,t.add(this,"draginit."+d.livekey,d.delegate)),e.each(d.defaults,function(e){void 0!==r[e]&&(n[e]=r[e])})},remove:function(){e.data(this,d.datakey).related-=1},setup:function(){if(!e.data(this,d.datakey)){var a=e.extend({related:0},d.defaults);e.data(this,d.datakey,a),t.add(this,n,d.init,a),this.attachEvent&&this.attachEvent("ondragstart",d.dontstart)}},teardown:function(){e.data(this,d.datakey).related||(e.removeData(this,d.datakey),t.remove(this,n,d.init),t.remove(this,"draginit",d.delegate),d.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",d.dontstart))},init:function(n){var i,l=n.data,s=n.originalEvent?n.originalEvent.changedTouches||n.originalEvent.touches:[];if(s&&s.length){if(s.length>1)return}else if(l.which>0&&n.which!=l.which)return;if(!e(n.target).is(l.not)&&(!l.handle||e(n.target).closest(l.handle,n.currentTarget).length)&&(l.propagates=1,l.interactions=[d.interaction(this,l)],l.target=n.target,l.pageX=n.pageX,l.pageY=n.pageY,l.dragging=null,i=d.hijack(n,"draginit",l),l.propagates))return i=d.flatten(i),i&&i.length&&(l.interactions=[],e.each(i,function(){l.interactions.push(d.interaction(this,l))})),l.propagates=l.interactions.length,l.drop!==!1&&o.drop&&o.drop.handler(n,l),d.textselect(!1),t.add(document,r,d.handler,l),a?void 0:!1},interaction:function(t,a){return{drag:t,callback:new d.callback,droppable:[],offset:e(t)[a.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(e){var a=e.data;if(!a.dragging&&("mousemove"===e.type||"touchmove"===e.type)){if(Math.pow(e.pageX-a.pageX,2)+Math.pow(e.pageY-a.pageY,2)<Math.pow(a.distance,2))return;e.target=a.target,d.hijack(e,"dragstart",a),a.propagates&&(a.dragging=!0)}switch(e.type){case"touchmove":a.dragging&&(e.preventDefault(),i(e,a));case"mousemove":if(a.dragging){if(d.hijack(e,"drag",a),a.propagates){a.drop!==!1&&o.drop&&o.drop.handler(e,a);break}e.type="mouseup"}case"mouseup":case"touchend":t.remove(document,r,d.handler),a.dragging&&(a.drop!==!1&&o.drop&&o.drop.handler(e,a),d.hijack(e,"dragend",a)),d.textselect(!0),a.click===!1&&a.dragging&&(jQuery.event.triggered=!0,setTimeout(function(){jQuery.event.triggered=!1},20),a.dragging=!1)}},delegate:function(a){var n,r=[],i=e.data(this,"events")||{};return e.each(i.live||[],function(i,o){0===o.preType.indexOf("drag")&&(n=e(a.target).closest(o.selector,a.currentTarget)[0],n&&(t.add(n,o.origType+"."+d.livekey,o.origHandler,o.data),e.inArray(n,r)<0&&r.push(n)))}),r.length?e(r).bind("dragend."+d.livekey,function(){t.remove(this,"."+d.livekey)}):!1},hijack:function(a,n,r,i,o){if(r){var l,s,c,g={event:a.originalEvent,type:a.type},u=n.indexOf("drop")?"drag":"drop",p=i||0,h=isNaN(i)?r.interactions.length:i;a.type=n,a.sourceEvent=g.event,a.originalEvent=null,r.results=[];do if(s=r.interactions[p]){if("dragend"!==n&&s.cancelled)continue;c=d.properties(a,r,s),s.results=[],e(o||s[u]||r.droppable).each(function(i,o){return c.target=o,l=o?t.dispatch.call(o,a,c):null,l===!1?("drag"==u&&(s.cancelled=!0,r.propagates-=1),"drop"==n&&(s[u][i]=null)):"dropinit"==n&&s.droppable.push(d.element(l)||o),"dragstart"==n&&(s.proxy=e(d.element(l)||s.drag)[0]),s.results.push(l),delete a.result,"dropinit"!==n?l:void 0}),r.results[p]=d.flatten(s.results),"dropinit"==n&&(s.droppable=d.flatten(s.droppable)),"dragstart"!=n||s.cancelled||c.update()}while(++p<h);return a.type=g.type,a.originalEvent=g.event,d.flatten(r.results)}},properties:function(e,t,a){var n=a.callback;return n.drag=a.drag,n.proxy=a.proxy||a.drag,n.startX=t.pageX,n.startY=t.pageY,n.deltaX=e.pageX-t.pageX,n.deltaY=e.pageY-t.pageY,n.originalX=a.offset.left,n.originalY=a.offset.top,n.offsetX=e.pageX-(t.pageX-n.originalX),n.offsetY=e.pageY-(t.pageY-n.originalY),n.drop=d.flatten((a.drop||[]).slice()),n.available=d.flatten((a.droppable||[]).slice()),n},element:function(e){return e&&(e.jquery||1==e.nodeType)?e:void 0},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?d.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",d.dontstart).attr("unselectable",t?"off":"on").css("MozUserSelect",t?"":"none")},dontstart:function(){return!1},callback:function(){}};d.callback.prototype={update:function(){o.drop&&this.available.length&&e.each(this.available,function(e){o.drop.locate(this,e)})}},o.draginit=o.dragstart=o.dragend=d}(jQuery);